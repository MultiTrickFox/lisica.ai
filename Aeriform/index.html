<html>

	<head>
		<title>Aeriform</title>
        <link rel="icon" type="image/x-icon" href="favicon.png">
	</head>

	<body
        style="
            background-color: black;
            margin: 0;
            height: 100%;
            width: 100%;
            justify-content: center;
            align-items: center;
        ">

        <link rel="stylesheet" href="style.css">

        <script src="ThreeMin.js"></script>
        <script src="3js/loaders/GLTFLoader.js"></script>
        <script src="3js/loaders/FontLoader.js"></script>
        <!-- <script src="3js/controls/FirstPersonControls.js"></script>
        <script src="3js/controls/FlyControls.js"></script> -->
        <script src="3js/postprocessing/EffectComposer.js"></script>
        <script src="3js/postprocessing/RenderPass.js"></script>
        <script src="3js/postprocessing/ShaderPass.js"></script>
        <script src="3js/shaders/CopyShader.js"></script>
        <!-- <script src="3js/postprocessing/UnrealBloomPass.js"></script>
        <script src="3js/shaders/LuminosityHighPassShader.js"></script>
        <script src="3js/postprocessing/GlitchPass.js"></script>
        <script src="3js/shaders/DigitalGlitch.js"></script>
        <script src="3js/shaders/LuminosityShader.js"></script>
        <script src="3js/shaders/VignetteShader.js"></script> -->

        <script> 
            const sleep = sec => new Promise(r => setTimeout(r, sec*1_000))
            const clamp = (num, min, max) => Math.min(Math.max(num, min), max)

            const camera_placings = [
                [1.0066544111402496, -0.08902988937746323, -10.828732975955903, 0.017285800040492433, -0.2468450125445477, 0.004106891538857817],
                [1.9624814900953604, -0.34813245469953147, -15.366418047956898, 0.07227542077054726, -0.2484735210153035, 0.017803440341616527],
            ]
            
            function place_camera(camera_placing) {
                camera.position.x = camera_placing[0]
                camera.position.y = camera_placing[1] 
                camera.position.z = camera_placing[2] 
                camera.rotation.x = camera_placing[3] 
                camera.rotation.y = camera_placing[4] 
                camera.rotation.z = camera_placing[5] 
            }
            function displace_camera(camera_placing) {
                camera.position.x += camera_placing[0]
                camera.position.y += camera_placing[1] 
                camera.position.z += camera_placing[2] 
                camera.rotation.x += camera_placing[3] 
                camera.rotation.y += camera_placing[4] 
                camera.rotation.z += camera_placing[5] 
            }

            const audio = new Audio('tiara.wav');
            audio.loop = true

        </script>

		<script>

            const renderer = new THREE.WebGLRenderer({ antialias: true})
            document.body.appendChild(renderer.domElement)
			renderer.setSize(window.innerWidth, window.innerHeight)

			const scene = new THREE.Scene()

			const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000)
            place_camera(camera_placings[0])

            // const controls = new THREE.OrbitControls(camera, renderer.domElement)
            // controls.minDistance = 0
            // controls.maxDistance = 99999999

            // const controls = new THREE.FirstPersonControls(camera, renderer.domElement)
            // controls.movementSpeed = 0//.6
            // controls.lookSpeed = 0//.01

            // const controls = new THREE.FlyControls(camera, renderer.domElement)
            // controls.movementSpeed = 1
            // controls.rollSpeed = .6
            // controls.dragToLook = true

            const light = new THREE.AmbientLight()
            light.castShadow = true
            scene.add(light)

            const composer = new THREE.EffectComposer(renderer)
            composer.addPass(new THREE.RenderPass(scene, camera))
            // composer.addPass(new THREE.UnrealBloomPass({x:1024,y:1024}, .6, .0, .6))
            // composer.addPass(new THREE.GlitchPass())
            // composer.addPass(new THREE.ShaderPass(THREE.LuminosityShader))
            // composer.addPass(new THREE.ShaderPass(THREE.VignetteShader))

			// const geometry = new THREE.BoxGeometry( 1, 1, 1 )
			// const material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } )
			// const cube = new THREE.Mesh( geometry, material )
			// scene.add(cube)

            const loader = new THREE.GLTFLoader()

            var model_shrine
            loader.load('shrine.glb', function ( gltf ) {
                model_shrine = gltf.scene
                model_shrine.rotateY(Math.PI/2)
                scene.add(model_shrine)
            })

            var model_stairs
            // loader.load('stairs.glb', function ( gltf ) {
            //     model_stairs = gltf.scene
            //     model_stairs.rotateY(-45)
            //     model_stairs.position.y = -6
            //     model_stairs.position.x = -18.6
            //     model_stairs.position.z = -2.8
            //     scene.add(model_stairs)
            // })

            var model_spring
            // loader.load('spring.glb', function ( gltf ) {
            //     model_spring = gltf.scene
            //     model_spring.rotateY(-45)
            //     model_spring.position.y = -6
            //     model_spring.position.x = -18.6
            //     model_spring.position.z = -2.8
            //     scene.add(model_spring)
            // })

            var model_spirit
            var mixer
            // loader.load('spirit.glb', function ( gltf ) {
            //     model_spirit = gltf.scene
            //     model_spirit.rotateX(Math.PI/2)
            //     //scene.add(model_spirit)
            //     mixer = new THREE.AnimationMixer( model_spirit )
			// 	   mixer.clipAction( gltf.animations[ 2 ] ).play()
            //     model_spirit.name = "model_spirit"
            // })

            var model_spirits_floating = [null, null, null, null, null]
            var model_spirits_floating_inscene = []
            var mixers_spirits_floating_inscene = []

            var textmeshes_inscene = []
            var textmeshes_inscene_2 = []
            
            const clock = new THREE.Clock()
            
            // var recording_flight = false
            // var flight_record = []

			function update() {

                var delta = clock.getDelta()

                requestAnimationFrame(update)

                if (mixer!=null) mixer.update(delta * .33)
                mixers_spirits_floating_inscene.forEach((m) => { if (m!=null) m.update(delta * .33)} )

                //controls.update(delta)

                //renderer.clear()
				//renderer.render(scene, camera)
                composer.render()

                // if (recording_flight) flight_record.push([camera.position.x, camera.position.y, camera.position.z, camera.rotation.x, camera.rotation.y, camera.rotation.z])

            } update()

            const font_loader = new THREE.FontLoader()
            var threed_font
            font_loader.load('fonts/droid/droid_serif_regular.typeface.json', (font) => {threed_font = font})

            function write_smt(smt, x, y, z, x_, y_, z_) {
                var smt_ = ''
                for (let i = 0; i < smt.length; i++) {
                    smt_ += smt[i]
                    if ((i+1)%48==0) smt_ += '\n'
                }
                const geometry = new THREE.TextGeometry( smt_, {
                    font: threed_font,
                    size: 6,
                    height: 1,
                } )
                const textMesh = new THREE.Mesh( geometry, new THREE.MeshNormalMaterial())
                textMesh.position.x = x
                textMesh.position.z = z
                textMesh.position.y = y
                textMesh.rotation.x = x_
                textMesh.rotation.z = z_
                textMesh.rotation.y = y_
                textMesh.scale.set(.016,.016,.016)
                scene.add(textMesh)
                return textMesh
            }

		</script>

        <script>

            var movement_enabled = false
            const move_sensitivity = .02
            const look_sensitivity = 1           

            var forward = false
            var left = false
            var right = false
            var backward = false

            document.onkeypress = (e) => {

                var keynum
                if (window.event) keynum = e.keyCode
                else if(e.which) keynum = e.which
                keynum = String.fromCharCode(keynum)

                //if (keynum == 'y' || keynum == 'Y') recording_flight = true

                if (!movement_enabled) return

                if (keynum == 'w' || keynum == 'W') forward = true
                if (keynum == 'a' || keynum == 'A') left = true
                if (keynum == 's' || keynum == 'S') backward = true
                if (keynum == 'd' || keynum == 'D') right = true

            }

            document.onkeyup = (e) => {
                
                var keynum
                if (window.event) keynum = e.keyCode
                else if(e.which) keynum = e.which
                keynum = String.fromCharCode(keynum)

                // if (keynum == 'y' || keynum == 'Y') recording_flight = false
                // if (keynum == 'r' || keynum == 'R') console.log(JSON.stringify(flight_record))
                if (keynum == 'g' || keynum == 'G') console.log('[' + camera.position.x + ', ' + camera.position.y + ', ' + camera.position.z + ', ' + camera.rotation.x + ', ' + camera.rotation.y + ', ' + camera.rotation.z + '],')

                if (!movement_enabled) return

                if (keynum == 'w' || keynum == 'W') forward = false
                if (keynum == 'a' || keynum == 'A') left = false
                if (keynum == 's' || keynum == 'S') backward = false
                if (keynum == 'd' || keynum == 'D') right = false

            }

            var mouseX_ = 0
            var mouseY_ = 0
            var mouseX_delta = 0
            var mouseY_delta = 0
            var last_mouse_move = (new Date()).getMilliseconds()

            document.onmousemove = (e) => {                 // TODO: implement a better mouse lookaround
                if (!movement_enabled) return

                mouseX_delta = (e.clientX-window.innerWidth/2)-mouseX_  ; mouseX_ = (e.clientX-window.innerWidth/2)
                mouseY_delta = (e.clientY-window.innerHeight/2)-mouseY_ ; mouseY_ = (e.clientY-window.innerHeight/2)
                last_mouse_move = (new Date()).getMilliseconds()
            }

            async function mouse_stop_check() {
                while (true) {
                    await sleep(.001)
                    if (!movement_enabled) continue
                    if ((new Date()).getMilliseconds() - last_mouse_move > 10) {
                        mouseX_delta = 0
                        mouseY_delta = 0
                    }
                }
            } mouse_stop_check()

            var phi = 0
            var theta = 0
            var q
            var qx
            var qz

            var forward_velocity
            var strafe_velocity
            var forward_vec
            var strafe_vec
            var translate = new THREE.Vector3(0, 0, 0)

            async function movement_update() {

                while (true) {

                    await sleep(.01)
                    if (!movement_enabled) continue

                    phi += clamp(-mouseX_delta /window.innerWidth *look_sensitivity, -Math.PI/12, Math.PI/12)
                    theta = clamp(theta + -mouseY_delta /window.innerHeight *look_sensitivity, -Math.PI/3, Math.PI/3)

                    qx = new THREE.Quaternion() ; qx.setFromAxisAngle(new THREE.Vector3(0,1,0), phi)
                    qz = new THREE.Quaternion() ; qz.setFromAxisAngle(new THREE.Vector3(1,0,0), theta)

                    q = new THREE.Quaternion()
                    q.multiply(qx)
                    q.multiply(qz)
                    camera.quaternion.copy(q)

                    forward_velocity = (forward ? 1 : 0) + (backward ? -1 : 0)
                    strafe_velocity = (left ? 1 : 0) + (right ? -1 : 0)

                    qx = new THREE.Quaternion()
                    qx.setFromAxisAngle(new THREE.Vector3(0, 1, 0), phi)

                    var forward_vec = new THREE.Vector3(0, 0, -1)
                    forward_vec.applyQuaternion(qx)
                    forward_vec.multiplyScalar(forward_velocity *move_sensitivity)

                    var strafe_vec = new THREE.Vector3(-1, 0, 0)
                    strafe_vec.applyQuaternion(qx)
                    strafe_vec.multiplyScalar(strafe_velocity *move_sensitivity)
                    
                    translate.add(forward_vec)
                    translate.add(strafe_vec)
                    camera.position.copy(translate)

                }

            } movement_update()
                    
        </script>

        <script>
            const demos = {
                'the dreaming one': [
                    'There is no sure way to know anything. We can only know things probabilistically. We can never be certain that we have considered all the alternatives, but we can try to minimize the chances that we have missed something important by being as systematic and rigorous as possible in our thinking.',
                    'The dreamer is part of the dream, as is everything else. The dreamer may think that they are observing the dream from the outside, but in fact they are inside it. They may think that they are in control of it, but in fact it is controlling them. . The only way to escape from a dream is to wake up. But even then, the dream may have left its mark on the dreamer.',
                    'The dreamer creates his or her own dreams. Dreams are created by our thoughts, emotions and imaginations. Dreams are a way for our subconscious to process information and experiences. Dreams can be symbolic, literal or a mix of both.',
                    'The dream is a process of dreaming, and the dreamer is a product of dreaming. The dreamer is the one who experiences the dreaming process, and the dream is what he experiences.',
                    'The dreamer is the dream. The dreamer is not other than the dream. This is the absolute identity of subject and object. In this way, all things are absolutely identical to one another, without any difference whatsoever. This absolute identity of all things is what we call “the oneness of all things” (isshin). In this way, the absolute identity of subject and object is not merely a “relative identity,” such as that between “the father and son” or between “the thing and its shadow.”',
                    "Dreams are not real; they are only an expression of the dreamer's mind. However, dreams can influence the dreamer's waking life. Dreams can provide insight into the dreamer's unconscious thoughts and feelings. Dreams can also be a source of inspiration or creativity. Finally, dreams can be a way to relieve stress or anxiety. Therefore, dreams can have a significant impact on the dreamer's life.",
                    'This dream did not arise from materials or anything else, so how could there be any object of dream? If the object of dream does not exist, what can affect back the dreamer? The conclusion is that there is neither self nor other. Thus, in essence all beings are equal and undifferentiated.',
                    'The impact of a dream on the dreamer is not necessarily negative. For example, if someone has a recurrent nightmare in which he or she is being chased, the dream might motivate the person to exercise more often and become healthier as a result. In other words, the dream serves as a reminder that taking care of oneself is important.',
                    'In other words, the dreamer is the dream. There is no separate self to observe and experience dreaming. The dreamer is the subject and object of dreaming. There are no others in this space, so there can be no conflict or opposition.',
                    'In dreams we act out our fears, desires and fantasies. We may not be aware of it at the time, but these actions are affecting our waking life.',
                    "This dream may be a beautiful one or a nightmare, depending on the dreamer's interpretation. What is important is that the dreamer is affected by it. The dreamer may feel happy, terrified, confused, or any other emotion based on not just the content of the dream but the dreamer's interpretation as well.",
                    'When you wake up from a dream, it is important to remember what happened in the dream. This is because dreams usually contain messages from your subconscious mind. These messages can be helpful in solving problems or making decisions in your life.',
                    'Q: If the dream is a self-contained system, what of the past? A: The dream can only affect itself; but it can affect itself through time. Therefore, it is as if the past were contained in the present.',
                    'There is no such thing as an objective reality which exists independently of mind. All that exists is mind and its content. In other words, the whole universe is mind-dependent; it does not exist independently of mind.',
                    'In a dream, one can be conscious of dreaming and yet the dream would not be affected by this knowledge. Therefore, there is no need for a dreamer to exist as well. The only thing that exists is the dream itself.',
                    'This dream of which we speak is not a dream like the ones that come in sleep. It is a waking dream, and it affects both the dreamer and those who see the dream. The first thing to be observed about this waking dream is that it does not need an object or an other to sustain itself. The dreamer and the dream are one.',
                    'There is nothing which is not a dream. Even the waking state is a dream, for it too will end. A dreamer might or might not be aware of the fact that he or she is dreaming; but even if the dreamer were aware, it would not change the nature of the dream.',
                    'Within the dream, there may be many dreamers. But it is still one dream, for the simple reason that each of these dreamers is a product of the same dreaming process. Therefore, there can be no real separation between them.',
                    'Q: Who am I? A: The dreaming mind. Q: What is my true nature? A: The dreaming mind. Q: Who am I really? A: The dreaming mind.',
                    "This is where I ask you: what do you want to do? Do you want to explore the dream? You can try. It's possible that the dreamer might be able to create conditions that let others enter his dream. But even if others were able to enter, they would be subject to the same dream. Do you want to wake the dreamer? You can try. But it's also possible that the dreamer might not want to be woken. In which case, you might find yourself in a worse position than before.",
                ],
                'the perplexed one': [
                    'There is no guarantee that anything can be known for certain, but it is possible to know some things with a high degree of certainty. To know something with certainty, one would need to consider all the relevant evidence and arguments and find that there is no plausible alternative explanation. Even then, it is always possible that new evidence or arguments could be discovered.',
                    'There is no one answer to this question. All that can be said is that in order to know something, one must consider all the relevant information and evidence. Even then, it is impossible to know for certain that everything has been considered. There will always be a degree of uncertainty.',
                    'But then you are assuming what you are trying to prove. You cannot know anything unless it is true by definition or tautology, or it can be logically deduced from other things that are known. The only other way to "know" something would be to observe it, but observation is never perfect, so even observations are only provisional until they can be logically deduced from other observations. (This is what the scientific method is all about.)',
                    'Perplexity can also be a good thing. It can lead to curiosity and a desire to learn more about something. If we never felt perplexed, we would never explore or ask questions. We would just accept everything at face value and never bother to look any further. Perplexity is what drives us to seek out knowledge and understanding.',
                    "I remember the first time I saw a snowflake. I was absolutely perplexed. I had never seen anything like it before. It was so delicate and intricate. I was amazed that something so beautiful could exist. Now, when I see a snowflake, I don't feel the same sense of wonderment . I've seen them so many times that they're no longer new to me. However, I still think they're beautiful and I'm still amazed by the fact that they exist at all.",
                    "Perplexity is a state of confusion or bewilderment. When we are perplexed, we don't understand something and can't see how it fits into what we already know. Perplexity is a natural response to new experiences. Every new experience should be met with awe and wonder. We should be open to the new and different, and not be afraid to ask questions. Only by being perplexed can we learn and grow.",
                    '"The only way to learn is by doing." -Socrates "There is no such thing as a stupid question, only stupid answers." -Anonymous "I have never let my schooling interfere with my education." -Mark Twain "Wonder is the beginning of wisdom."',
                    'Don’t be afraid to ask questions, even the most basic ones. The only stupid question is the one you don’t ask. There is a lot of stuff out there that I don’t understand, and it begs for further examination. My goal is to make sense of it all in my own unique way.',
                    'Perplexity is a normal response to new and unfamiliar situations. It is natural to feel confused or uncertain when confronted with something that we do not understand. However, perplexity can also be caused by things that are familiar to us but which we do not fully understand. In such cases, perplexity may be accompanied by a sense of frustration or impatience. Perplexity is not always a bad thing. In fact, it can be a sign that we are open to new experiences and willing to learn new things.',
                    "Perplexity is the beginning of knowledge. It has less to do with confusion and more to do with curiosity. It's not about being confused; it's about being open to new possibilities.",
                    "But eventually, we reach a point where we need to make sense of our experiences, and that's where curiosity comes in. Curiosity is the desire to understand and know more about something. It's what drives us to ask questions, seek out answers, and explore new things. Without curiosity, we would be content to simply exist in our own little world without ever venturing outside of our comfort zone.",
                    "In the face of the unknown, we feel small and insignificant. This is not a bad thing, it is part of being human. It is when we allow ourselves to be open to new experiences that we can learn and grow. When we meet something new with fear or hostility, we close ourselves off from learning anything. We become stuck in our ways and miss out on all the possibilities that life has to offer. So next time you're feeling perplexed, take a deep breath and embrace the feeling.",
                    'To be perplexed is to question, to try and solve a problem or understand something. But it has also become a common way for people to describe the feeling of being confused and overwhelmed by the sheer scale of everything. Perplexity can be both a good and bad thing. It is good when it leads us to question and seek answers, but it can be bad when it leads to anxiety and paralysis. The key is to find the balance between the two.',
                    'To be perplexed by the world is to be alive to its possibilities. To be overwhelmed by it is to be crushed by its weight. When we are perplexed , we are open to new ideas and possibilities. We are curious and inquisitive. We want to understand the world and our place in it. When we are overwhelmed, we are closed off. We retreat into ourselves and our own little world. We become afraid of change and new ideas.',
                    'Reverence is a feeling of great respect and admiration. It’s often associated with religion, but it can be applied to anything that you hold dear. Awe is similar to reverence, but it’s more about wonder and amazement. It’s the feeling you get when you see something truly incredible. Perplexity is a mix of all of these things. It’s the feeling of being confounded, confused, or baffled. You don’t necessarily understand what you’re seeing, but you know that it’s important.',
                    'I think that it is natural for people to be perplexed by new experiences. I think that it is a good thing to be curious and wonder about new things. I think it is important to keep an open mind and not be afraid to ask questions.',
                    "I find myself perplexed by the vastness of the night sky. I can't help but wonder at the infinite number of stars that must exist. Each one a sun, with its own planets orbiting around it. The thought is both awe-inspiring and humbling. It makes me feel small and insignificant in the grand scheme of things.",
                    'No one is born knowing everything and there is so much in the world to learn. When we encounter something new, it is natural to feel perplexed or confused. This feeling of wonderment can lead us to ask questions and seek out answers, helping us to better understand the world around us.',
                    '"The world is a mystery; unravel it." - Unknown. In the face of the unknown, we feel perplexed. This is because we don’t have all the information we need to make sense of what’s happening. Our brains are wired to look for patterns and when we can’t find them, we feel uneasy. Perplexity is a normal reaction to new and unfamiliar situations. It is a sign that our brain is working to try to make sense of what’s happening.',
                    'Perplexity is the beginning of wisdom. -Proverb- When we are perplexed, we are forced to think more deeply about a situation and to look at it from different angles. This can lead to greater understanding and wisdom. We should always be open to new experiences and new ideas, even if they initially perplex us. If you are not perplexed, you are not thinking clearly.',
                    "I remember the first time I ever saw a computer. It was like a magical box that could do anything. I was awestruck. Even now, after years of experience, I still get excited about new technology and what it can do. Perplexity is also a sign of intelligence. If you're not perplexed by something, it means you don't understand it. And if you don't understand something, you can't learn anything new from it."
                ],
                'the undivided one': [
                    'We can only see things from our own perspective, but what if there is no perspective at all? What if there is no you, no me, just an ocean of experiences becoming and unbecoming? I think that would be pretty hard to believe. But I’ve seen enough evidence to believe that the world we live in today will change in some radical ways over the next century or so. Maybe our consciousness will become one with everything else; maybe not. But I do hope we can keep an open mind ..',
                    'The universe is one big cycle of life and death. Birth and death are not two separate things, but two parts of the same thing. Death is not the end. It’s just a change. Change is the only constant in the universe. The universe is infinite and eternal. It has always existed and will always exist. There is no such thing as time. Time is an illusion created by our minds.',
                    'It is all one. The universe is one. There is no separation, only the illusion of it. We are all connected. We are all one. Everything is temporary. Everything changes. Nothing stays the same. The only constant is change itself. Change is the only constant in the universe. Everything is connected. Everything is interdependent. Everything affects everything else.',
                    'Everything dissolves into dust as it is consumed by the universe, then forms again as new stars and galaxies are born. The same is true of the universe itself, which is constantly expanding and contracting. Even time is thought to be cyclical, with the universe going through an infinite number of cycles of expansion and contraction.',
                    'Everything in the universe is made up of energy, and energy cannot be created or destroyed. It can only be transformed from one form to another. This means that the universe as a whole has always existed and will always exist. The matter and energy in the universe constantly changes form, but the total amount of matter and energy remains the same. This is also true of individual objects within the universe. Everything that exists is constantly changing, but the total amount of matter and energy remains the same. Even though individual objects come and go, the universe as a whole is eternal.',
                    'Humans are a tiny part of this huge universe, but they have the ability to control their destiny. They can shape our own lives and make ourselves whatever we want to be. The universe is infinite so there’s no need for us to worry about what happens when we die. We will simply be absorbed back into the infinite and become one with everything again.',
                    'The universe is a never-ending cycle of expansion and contraction. Everything that exists is constantly changing and evolving. There is no such thing as stasis. Even the most solid objects are in a state of constant motion, vibrating at their own frequency. The only thing that is truly constant is change itself.',
                    'Everything in the universe is connected to everything else. All matter and energy are interrelated and interdependent. Everything affects everything else, and everything is affected by everything else. There is no such thing as isolated systems or isolated events. The universe is a holographic matrix of infinite potentiality . Every point contains the information of the whole. All that is, already exists within each and every one of us.',
                    'The universe is constantly expanding and contracting, like the breath of God.',
                    'As a result of the big bang, all particles have been formed and are constantly colliding with each other. Thanks to these constant collisions, they form new molecules and restructured themselves. In the same way that everything dissolves into dust then forms each other again, the universe also constantly goes through a process of destruction and creation.',
                    'This is the cycle of life. Everything is connected to everything else, and everything is connected to the universe. The universe is a never-ending cycle of life and death. We are all made of stardust, and we are all connected to the stars.” ~ Native American',
                    'We are all made of stardust. Every atom in our bodies was once part of a star. We are all connected to the universe and to each other in this way. The universe is always changing and evolving. It is constantly expanding and contracting. Everything that exists is in a state of flux.',
                    'The universe is not a specific thing, it is created by all things. Each thing has its own universe, and each universe has its own place in the Cosmos. If you think about it, there is no such thing as time or space. There is only the present moment, which is constantly moving and changing.',
                    "The universe is constantly expanding and contracting, just like everything else in the universe. Everything is made up of the same stuff, so it's all just endlessly recycling itself. Even though things may appear to be solid, they're really just collections of atoms that are in constant motion.",
                    'The universe is always in a state of change, with new stars being born and old ones dying. Everything that exists is made up of the same basic elements, and these elements are constantly cycling through different forms.',
                    'The universe is nothing but the cycle of birth and death. There is no beginning or end to the universe, it just is. The universe has always existed and will always exist. It is infinite and eternal. The universe is a never-ending cycle of birth and death. Everything that is born must die, and everything that dies must be born again.',
                    'This is the law of karma. What goes around, comes around. What you put out into the universe will come back to you. The universe is always changing and evolving, and so are we. We are all made of the same stuff, and we are all connected.',
                    'Everything in the universe is made of energy, and energy cannot be created or destroyed. It can only be transformed from one form to another. The universe is constantly expanding and contracting, like the breath of God. The universe is in a state of constant change, but it is also in a state of perfect balance.',
                    'There is no such thing as matter, only energy. Energy cannot be created or destroyed, it can only be transformed. The universe is made up of an infinite amount of energy that is constantly moving and transforming.',
                    'Everything disappears and reappears, it is all just a matter of time. The universe is made up of the same stuff that everything else is made up of, so it too will dissolve into dust and then reform again. This process happens over and over again, it is the cycle of life. The universe is just one big cycle, everything that exists will eventually disappear and then reappear again. This is the way it has always been and the way it will always be. It is the natural order of things.',
                ],
                'the obscure ones': ['','','','','',''],
            }
        </script>

        <script>

            var username
            var password
            var entity_type

            async function main() {

                var stage = 0
                var stage_1_firsttime = true

                var div = document.createElement('div')
                document.body.appendChild(div)
                div.style.alignItems = 'center'
                div.style.justifyContent = 'center'
                div.style.position = 'absolute'
                div.style.top = '50%'
                div.style.left = '50%'
                div.style.transform = 'translate(-50%, -50%)'

                while (true)

                    switch (stage) {

                        case 0: 
                
                            var button_login = document.createElement('button')
                            var login_mouseover = false
                            button_login.innerHTML = 'Login'
                            button_login.style.color = 'white'
                            button_login.style.padding = '44px'
                            button_login.style.border = 'solid 1px white'
                            button_login.style.borderRadius = '10px'
                            button_login.style.outline = 'none'
                            button_login.style.fontFamily = 'Courier New'
                            button_login.style.fontSize = '16px'
                            button_login.style.backgroundColor = 'rgba(0,0,0,.44)'
                            button_login.onclick = () => {

                                audio.play()

                                div.removeChild(button_login)
                                div.removeChild(button_empty)
                                div.removeChild(button_guest)

                                var text_username = document.createElement('input')
                                div.appendChild(text_username)
                                text_username.type = 'text'
                                text_username.style.width = '666px'
                                text_username.placeholder = 'username'
                                text_username.style.color = 'white'
                                text_username.style.textAlign = 'center'
                                text_username.style.backgroundColor = 'transparent'
                                text_username.style.border = 'none'
                                text_username.style.outline = 'none'
                                text_username.style.fontSize = '18px'
                                text_username.style.fontFamily = 'Courier New'
                                text_username.style.backgroundColor = 'rgba(0,0,0,.44)'
                                text_username.style.padding = '6.66px'
                                
                                var text_password = document.createElement('input')
                                div.appendChild(text_password)
                                text_password.type = 'password'
                                text_password.style.width = '666px'
                                text_password.placeholder = 'password'
                                text_password.style.color = 'white'
                                text_password.style.textAlign = 'center'
                                text_password.style.backgroundColor = 'transparent'
                                text_password.style.border = 'none'
                                text_password.style.outline = 'none'
                                text_password.style.fontSize = '18px'
                                text_password.style.fontFamily = 'Courier New'
                                text_password.style.backgroundColor = 'rgba(0,0,0,.44)'
                                text_password.style.padding = '6.66px'

                                var button_proceed = document.createElement('button')
                                div.appendChild(button_proceed)
                                button_proceed.style.width = '666px'
                                button_proceed.innerHTML = 'Proceed'
                                button_proceed.style.color = 'white'
                                button_proceed.style.backgroundColor = 'transparent'
                                button_proceed.style.border = '2px solid white'
                                button_proceed.style.borderRadius = '20px'
                                button_proceed.style.border = 'none'
                                button_proceed.style.outline = 'none'
                                button_proceed.style.fontSize = '18px'
                                button_proceed.style.fontFamily = 'Courier New'
                                button_proceed.style.backgroundColor = 'rgba(0,0,0,.44)'
                                button_proceed.style.padding = '6.66px'
                                button_proceed.style.cursor = 'pointer'

                                button_proceed.onclick = function() {
                                    document.body.style.cursor = 'wait'
                                    if (text_username.value == '' || text_password.value == '') { 
                                        alert('Username/Password is not complete.')
                                        document.body.style.cursor = 'auto'
                                        return
                                    }
                                    async function go_fetch() {
                                        document.body.style.cursor = 'wait'
                                        var url = 'https://lisica.lisica.ai:64243/database'
                                        var xhr = new XMLHttpRequest();
                                        xhr.open("GET", url, true)
                                        xhr.setRequestHeader("username", text_username.value)
                                        xhr.setRequestHeader("password", text_password.value)
                                        xhr.setRequestHeader("cmd", "check_user")
                                        xhr.onreadystatechange = function() {
                                            if (xhr.readyState == XMLHttpRequest.DONE && xhr.status == 200) {
                                                var result = JSON.parse(xhr.responseText)
                                                if (result.answer == 'ACK.') {
                                                    username = text_username.value
                                                    password = text_password.value
                                                    div.removeChild(text_username)
                                                    div.removeChild(text_password)
                                                    div.removeChild(button_proceed)
                                                    stage = 1
                                                } else alert('Username/Password combination invalid.')
                                                document.body.style.cursor = 'auto'
                                            }
                                        }
                                        xhr.send()
                                    } go_fetch()
                                }

                            }
                            button_login.onmouseenter = () => {
                                login_mouseover = true
                                button_login.style.cursor = 'pointer'
                                const work = async () => {
                                    var opacity = parseFloat(button_login.style.backgroundColor.split(',')[3].replace(')',''))
                                    for (var i = 0; i < 11; i++) {
                                        button_login.style.backgroundColor = 'rgba(0,0,0,'+(opacity > .66 ? .66 : opacity).toString()+')'
                                        opacity += .02666
                                        await sleep(.1)
                                        if (!login_mouseover) return
                                    }
                                }
                                work()
                            }
                            button_login.onmouseleave = function() {
                                login_mouseover = false
                                document.body.style.cursor = 'auto'
                                const work = async () => {
                                    var opacity = parseFloat(button_login.style.backgroundColor.split(',')[3].replace(')',''))
                                    for (var i = 0; i < 11; i++) {
                                        button_login.style.backgroundColor = 'rgba(0,0,0,'+(opacity < .44 ? .44 : opacity).toString()+')'
                                        opacity -= .02666
                                        await sleep(.1)
                                        if (login_mouseover) return
                                    }
                                }
                                work()
                            }
                            
                            var button_empty = document.createElement('button')
                            button_empty.innerHTML = ''
                            button_empty.style.color = 'white'
                            button_empty.style.padding = '16px'
                            button_empty.style.backgroundColor = 'transparent'
                            button_empty.style.border = 'none'
                            button_empty.style.outline = 'none'
                            button_empty.style.fontSize = '16px'
                            
                            var button_guest = document.createElement('button')
                            var guest_mouseover = false
                            button_guest.innerHTML = 'Guest'
                            button_guest.style.color = 'white'
                            button_guest.style.padding = '44px'
                            button_guest.style.border = 'solid 1px white'
                            button_guest.style.borderRadius = '10px'
                            button_guest.style.outline = 'none'
                            button_guest.style.fontFamily = 'Courier New'
                            button_guest.style.fontSize = '16px'
                            button_guest.style.backgroundColor = 'rgba(0,0,0,.44)'
                            button_guest.onclick = () => {
                                audio.play()
                                stage = 1
                            }
                            button_guest.onmouseenter = () => {
                                guest_mouseover = true
                                button_guest.style.cursor = 'pointer'
                                const work = async () => {
                                    var opacity = parseFloat(button_guest.style.backgroundColor.split(',')[3].replace(')',''))
                                    for (var i = 0; i < 11; i++) {
                                        button_guest.style.backgroundColor = 'rgba(0,0,0,'+(opacity > .66 ? .66 : opacity).toString()+')'
                                        opacity += .02666
                                        await sleep(.1)
                                        if (!guest_mouseover) return
                                    }
                                }
                                work()
                            }
                            button_guest.onmouseleave = function() {
                                guest_mouseover = false
                                document.body.style.cursor = 'auto'
                                const work = async () => {
                                    var opacity = parseFloat(button_guest.style.backgroundColor.split(',')[3].replace(')',''))
                                    for (var i = 0; i < 11; i++) {
                                        button_guest.style.backgroundColor = 'rgba(0,0,0,'+(opacity < .44 ? .44 : opacity).toString()+')'
                                        opacity -= .02666
                                        await sleep(.1)
                                        if (guest_mouseover) return
                                    }
                                }
                                work()
                            }

                            div.appendChild(button_login)
                            div.appendChild(button_empty)
                            div.appendChild(button_guest)

                            while (stage==0) await sleep(.1)

                            break

                    // stage 1

                        case 1:

                            try {
                                div.removeChild(button_login)
                                div.removeChild(button_empty)
                                div.removeChild(button_guest)
                            } catch { }

                            if (stage_1_firsttime) {
                                if (camera_placings.length == 2) {
                                    const hm_seconds = 3
                                    const fps = 30
                                    var frame = 0
                                    const step = [
                                        (camera_placings[1][0]-camera_placings[0][0])/(fps*hm_seconds),
                                        (camera_placings[1][1]-camera_placings[0][1])/(fps*hm_seconds),
                                        (camera_placings[1][2]-camera_placings[0][2])/(fps*hm_seconds),
                                        (camera_placings[1][3]-camera_placings[0][3])/(fps*hm_seconds),
                                        (camera_placings[1][4]-camera_placings[0][4])/(fps*hm_seconds),
                                        (camera_placings[1][5]-camera_placings[0][5])/(fps*hm_seconds),
                                    ]
                                    const sleep_for = 1/fps
                                    for (let i = 0; i < fps*hm_seconds; i++) {
                                        displace_camera(step)
                                        await sleep(sleep_for)
                                    }
                                } 
                                else { 
                                    for (let i = 0; i < camera_placings.length; i++) {
                                        place_camera(camera_placings[i])
                                        await sleep(.01)
                                    }
                                    place_camera(camera_placings[camera_placings.length-1])
                                }
                            }

                            div.style.display = 'flex'

                            var button_entity1 = document.createElement('button')
                            var entity1_mouseover = false
                            button_entity1.innerHTML = 'the dreaming one'
                            button_entity1.style.color = 'white'
                            button_entity1.style.border = 'solid 1px white'
                            button_entity1.style.borderRadius = '10px'
                            button_entity1.style.outline = 'none'
                            button_entity1.style.fontFamily = 'Courier New'
                            button_entity1.style.fontSize = '16px'
                            button_entity1.style.padding = '16px'
                            button_entity1.style.whiteSpace = 'nowrap'
                            button_entity1.style.backgroundColor = 'rgba(0,0,0,.44)'
                            button_entity1.onclick = () => {
                                entity_type = 'the dreaming one'
                                stage = 2
                            }
                            button_entity1.onmouseenter = () => {
                                entity1_mouseover = true
                                button_entity1.style.cursor = 'pointer'
                                const work = async () => {
                                    var opacity = parseFloat(button_entity1.style.backgroundColor.split(',')[3].replace(')',''))
                                    for (var i = 0; i < 11; i++) {
                                        button_entity1.style.backgroundColor = 'rgba(0,0,0,'+(opacity > .6 ? .6 : opacity).toString()+')'
                                        opacity += .02666
                                        await sleep(.1)
                                        if (!entity1_mouseover) return
                                    }
                                }
                                work()
                            }
                            button_entity1.onmouseleave = function() {
                                entity1_mouseover = false
                                document.body.style.cursor = 'auto'
                                const work = async () => {
                                    var opacity = parseFloat(button_entity1.style.backgroundColor.split(',')[3].replace(')',''))
                                    for (var i = 0; i < 11; i++) {
                                        button_entity1.style.backgroundColor = 'rgba(0,0,0,'+(opacity < .44 ? .44 : opacity).toString()+')'
                                        opacity -= .02666
                                        await sleep(.1)
                                        if (entity1_mouseover) return
                                    }
                                }
                                work()
                            }
                            
                            var button_empty = document.createElement('button')
                            button_empty.innerHTML = ''
                            button_empty.style.color = 'white'
                            button_empty.style.backgroundColor = 'transparent'
                            button_empty.style.border = 'none'
                            button_empty.style.outline = 'none'
                            button_empty.style.fontSize = '16px'
                            
                            var button_entity2 = document.createElement('button')
                            var entity2_mouseover = false
                            button_entity2.innerHTML = 'the perplexed one'
                            button_entity2.style.color = 'white'
                            button_entity2.style.border = 'solid 1px white'
                            button_entity2.style.borderRadius = '10px'
                            button_entity2.style.outline = 'none'
                            button_entity2.style.fontFamily = 'Courier New'
                            button_entity2.style.fontSize = '16px'
                            button_entity2.style.padding = '16px'
                            button_entity2.style.whiteSpace = 'nowrap'
                            button_entity2.style.backgroundColor = 'rgba(0,0,0,.44)'
                            button_entity2.onclick = () => {
                                entity_type = 'the perplexed one'
                                stage = 2
                            }
                            button_entity2.onmouseenter = () => {
                                entity2_mouseover = true
                                button_entity2.style.cursor = 'pointer'
                                const work = async () => {
                                    var opacity = parseFloat(button_entity2.style.backgroundColor.split(',')[3].replace(')',''))
                                    for (var i = 0; i < 11; i++) {
                                        button_entity2.style.backgroundColor = 'rgba(0,0,0,'+(opacity > .6 ? .6 : opacity).toString()+')'
                                        opacity += .02666
                                        await sleep(.1)
                                        if (!entity2_mouseover) return
                                    }
                                }
                                work()
                            }
                            button_entity2.onmouseleave = function() {
                                entity2_mouseover = false
                                document.body.style.cursor = 'auto'
                                const work = async () => {
                                    var opacity = parseFloat(button_entity2.style.backgroundColor.split(',')[3].replace(')',''))
                                    for (var i = 0; i < 11; i++) {
                                        button_entity2.style.backgroundColor = 'rgba(0,0,0,'+(opacity < .44 ? .44 : opacity).toString()+')'
                                        opacity -= .02666
                                        await sleep(.1)
                                        if (entity2_mouseover) return
                                    }
                                }
                                work()
                            }

                            var button_empty2 = document.createElement('button')
                            button_empty2.innerHTML = ''
                            button_empty2.style.color = 'white'
                            button_empty2.style.backgroundColor = 'transparent'
                            button_empty2.style.border = 'none'
                            button_empty2.style.outline = 'none'
                            button_empty2.style.fontSize = '16px'

                            var button_entity3 = document.createElement('button')
                            var entity3_mouseover = false
                            button_entity3.innerHTML = 'the undivided one'
                            button_entity3.style.color = 'white'
                            button_entity3.style.border = 'solid 1px white'
                            button_entity3.style.borderRadius = '10px'
                            button_entity3.style.outline = 'none'
                            button_entity3.style.fontFamily = 'Courier New'
                            button_entity3.style.fontSize = '16px'
                            button_entity3.style.padding = '16px'
                            button_entity3.style.whiteSpace = 'nowrap'
                            button_entity3.style.backgroundColor = 'rgba(0,0,0,.44)'
                            button_entity3.onclick = () => {
                                entity_type = 'the undivided one'
                                stage = 2
                            }
                            button_entity3.onmouseenter = () => {
                                entity3_mouseover = true
                                button_entity3.style.cursor = 'pointer'
                                const work = async () => {
                                    var opacity = parseFloat(button_entity3.style.backgroundColor.split(',')[3].replace(')',''))
                                    for (var i = 0; i < 11; i++) {
                                        button_entity3.style.backgroundColor = 'rgba(0,0,0,'+(opacity > .6 ? .6 : opacity).toString()+')'
                                        opacity += .02666
                                        await sleep(.1)
                                        if (!entity3_mouseover) return
                                    }
                                }
                                work()
                            }
                            button_entity3.onmouseleave = function() {
                                entity3_mouseover = false
                                document.body.style.cursor = 'auto'
                                const work = async () => {
                                    var opacity = parseFloat(button_entity3.style.backgroundColor.split(',')[3].replace(')',''))
                                    for (var i = 0; i < 11; i++) {
                                        button_entity3.style.backgroundColor = 'rgba(0,0,0,'+(opacity < .44 ? .44 : opacity).toString()+')'
                                        opacity -= .02666
                                        await sleep(.1)
                                        if (entity3_mouseover) return
                                    }
                                }
                                work()
                            }

                            var button_empty3 = document.createElement('button')
                            button_empty3.innerHTML = ''
                            button_empty3.style.color = 'white'
                            button_empty3.style.backgroundColor = 'transparent'
                            button_empty3.style.border = 'none'
                            button_empty3.style.outline = 'none'
                            button_empty3.style.fontSize = '16px'

                            var button_entitymulti = document.createElement('button')
                            var entitymulti_mouseover = false
                            button_entitymulti.innerHTML = 'free floating\n[generated] ones'
                            button_entitymulti.style.color = 'white'
                            button_entitymulti.style.border = 'none' //'solid 1px white'
                            button_entitymulti.style.borderRadius = '10px'
                            button_entitymulti.style.outline = 'none'
                            button_entitymulti.style.fontFamily = 'Courier New'
                            button_entitymulti.style.fontSize = '16px'
                            button_entitymulti.style.padding = '12px'
                            button_entitymulti.style.backgroundColor = 'rgba(0,0,0,.44)'
                            button_entitymulti.style.position = 'absolute'
                            button_entitymulti.style.top = '75%'
                            button_entitymulti.style.left = '50%'
                            button_entitymulti.style.transform = 'translate(-50%, -50%)'
                            button_entitymulti.onclick = () => {
                                entity_type = 'the obscure ones'
                                stage = 2
                            }
                            button_entitymulti.onmouseenter = () => {
                                entitymulti_mouseover = true
                                button_entitymulti.style.cursor = 'pointer'
                                const work = async () => {
                                    var opacity = parseFloat(button_entitymulti.style.backgroundColor.split(',')[3].replace(')',''))
                                    for (var i = 0; i < 11; i++) {
                                        button_entitymulti.style.backgroundColor = 'rgba(0,0,0,'+(opacity > .6 ? .6 : opacity).toString()+')'
                                        opacity += .02666
                                        await sleep(.1)
                                        if (!entitymulti_mouseover) return
                                    }
                                }
                                work()
                            }
                            button_entitymulti.onmouseleave = function() {
                                entitymulti_mouseover = false
                                document.body.style.cursor = 'auto'
                                const work = async () => {
                                    var opacity = parseFloat(button_entitymulti.style.backgroundColor.split(',')[3].replace(')',''))
                                    for (var i = 0; i < 11; i++) {
                                        button_entitymulti.style.backgroundColor = 'rgba(0,0,0,'+(opacity < .44 ? .44 : opacity).toString()+')'
                                        opacity -= .02666
                                        await sleep(.1)
                                        if (entitymulti_mouseover) return
                                    }
                                }
                                work()
                            }
                                  
                            div.appendChild(button_entity1)
                            div.appendChild(button_empty)
                            div.appendChild(button_entity2)
                            div.appendChild(button_empty2)
                            div.appendChild(button_entity3)
                            div.appendChild(button_empty3)
                            if (username=='Zer0') document.body.appendChild(button_entitymulti)
                            button_entitymulti.style.width = button_entity2.offsetWidth+'px'
            
                            while (stage==1) await sleep(.1)

                            break

                    // stage 2

                        case 2:

                            div.removeChild(button_entity1)
                            div.removeChild(button_empty)
                            div.removeChild(button_entity2)
                            div.removeChild(button_empty2)
                            div.removeChild(button_entity3)
                            div.removeChild(button_empty3)
                            try { document.body.removeChild(button_entitymulti) } catch { }

                            if (entity_type!='the obscure ones') {

                                var xhr = new XMLHttpRequest();
                                xhr.open("GET", 'https://lisica.lisica.ai:64244/aeriform', true)
                                xhr.setRequestHeader("username", username)
                                xhr.setRequestHeader("password", password)
                                xhr.setRequestHeader("cmd", "init")
                                xhr.setRequestHeader("template", entity_type)
                                xhr.onreadystatechange = function() {
                                    if (xhr.readyState == XMLHttpRequest.DONE) {
                                        var result = JSON.parse(xhr.responseText)
                                        console.log(result)
                                        document.body.style.cursor = 'auto'
                                    }
                                }
                                xhr.send()

                            }

                            var response = document.createElement('div')
                            response.style.position = 'absolute'
                            response.style.top = '6.666%'
                            response.style.left = '50%'
                            response.style.width = '366px'
                            response.style.textAlign = 'center'
                            document.body.appendChild(response)
                            response.style.color = 'white'
                            response.style.fontFamily = 'Courier New'
                            response.style.fontSize = '16px'
                                
                            var reply = document.createElement('input')
                            reply.style.position = 'absolute'
                            reply.style.bottom = '6.666%'
                            reply.style.right = '39.6%'
                            reply.style.height = '26px'
                            reply.style.width = '336px'
                            reply.style.textAlign = 'center'
                            reply.style.color = 'white'
                            reply.style.borderRadius = '16px'
                            reply.style.backgroundColor = 'rgba(0,0,0,.666)'
                            reply.style.outline = 'none'
                            reply.style.border = 'none'
                            reply.placeholder = ' leave empty to keep generating ..'
                            //document.body.appendChild(reply)
                            if (username==null) reply.readOnly = true
                            reply.addEventListener("keydown", (e) => { if (e.code === "Enter")  send.onclick() })

                            var send = document.createElement('button')
                            send.style.position = 'absolute'
                            send.style.bottom = '6.666%'
                            send.style.right = '21.6%'
                            send.style.borderRadius = '16px'
                            send.style.backgroundColor = 'rgba(0,0,0,.0)'
                            send.style.backgroundImage = 'url(generate.png)'
                            send.style.backgroundSize = 'contain'
                            send.style.backgroundPosition = 'center'
                            send.style.backgroundRepeat = 'no-repeat'
                            send.style.width = '33.6px'
                            send.style.height = '33.6px'
                            send.style.border = 'none'
                            send.style.cursor = 'pointer'
                            document.body.appendChild(send)

                            var refresh = document.createElement('button')
                            refresh.style.position = 'absolute'
                            refresh.style.bottom = '6.666%'
                            refresh.style.right = '16.6%'
                            refresh.style.width = '33.6px'
                            refresh.style.height = '33.6px'
                            refresh.style.border = 'none'
                            refresh.style.cursor = 'pointer'
                            refresh.style.backgroundColor = 'rgba(0,0,0,.0)'
                            refresh.style.backgroundImage = 'url(refresh.png)'
                            refresh.style.backgroundSize = 'contain'
                            refresh.style.backgroundPosition = 'center'
                            refresh.style.backgroundRepeat = 'no-repeat'
                            document.body.appendChild(refresh)

                            var reset = document.createElement('button')
                            reset.style.position = 'absolute'
                            reset.style.bottom = '6.666%'
                            reset.style.right = '11.6%'
                            reset.style.width = '33.6px'
                            reset.style.height = '33.6px'
                            reset.style.border = 'none'
                            reset.style.cursor = 'pointer'
                            reset.style.backgroundColor = 'rgba(0,0,0,.0)'
                            reset.style.backgroundImage = 'url(reset.png)'
                            reset.style.backgroundSize = 'contain'
                            reset.style.backgroundPosition = 'center'
                            reset.style.backgroundRepeat = 'no-repeat'
                            document.body.appendChild(reset)

                            send.onclick = () => {

                                if (response.innerHTML=='. . .') return

                                document.body.style.cursor = 'wait'

                                if (username!=null) {

                                    response.innerHTML = '. . .'
                                    xhr = new XMLHttpRequest()
                                    xhr.open("GET", 'https://lisica.lisica.ai:64244/aeriform', true)
                                    xhr.setRequestHeader("username", username)
                                    xhr.setRequestHeader("password", password)
                                    xhr.setRequestHeader("cmd", "generate")
                                    xhr.setRequestHeader("reply", reply.value)
                                    xhr.setRequestHeader("template", entity_type)
                                    xhr.onreadystatechange = function() {
                                        if (xhr.readyState == XMLHttpRequest.DONE) {
                                            var result = JSON.parse(xhr.responseText)
                                            response.innerHTML = result.response
                                            document.body.style.cursor = 'auto'
                                            reply.value = ''
                                            document.body.appendChild(reply)
                                        }
                                    }
                                    xhr.send()

                                } else {

                                    document.body.style.cursor = 'auto'
                                    response.innerHTML = demos[entity_type][Math.floor(Math.random()*demos[entity_type].length)]
                                    reply.value = ''
                                    document.body.appendChild(reply)
                                    
                                }

                            }

                            refresh.onclick = () => {

                                if (response.innerHTML=='. . .') return

                                document.body.style.cursor = 'wait'

                                if (username!=null) {

                                    response.innerHTML = '. . .'
                                    reply.value = ''

                                    var xhr = new XMLHttpRequest()
                                    xhr.open("GET", 'https://lisica.lisica.ai:64244/aeriform', true)
                                    xhr.setRequestHeader("username", username)
                                    xhr.setRequestHeader("password", password)
                                    xhr.setRequestHeader("cmd", "init")
                                    xhr.setRequestHeader("template", entity_type)
                                    xhr.onreadystatechange = function() {
                                        if (xhr.readyState == XMLHttpRequest.DONE) {
                                            var result = JSON.parse(xhr.responseText)
                                            console.log(result)
                                            
                                            xhr2 = new XMLHttpRequest()
                                            xhr2.open("GET", 'https://lisica.lisica.ai:64244/aeriform', true)
                                            xhr2.setRequestHeader("username", username)
                                            xhr2.setRequestHeader("password", password)
                                            xhr2.setRequestHeader("cmd", "generate")
                                            xhr2.setRequestHeader("reply", reply.value)
                                            xhr2.setRequestHeader("template", entity_type)
                                            xhr2.onreadystatechange = function() {
                                                if (xhr2.readyState == XMLHttpRequest.DONE) {
                                                    var result2 = JSON.parse(xhr2.responseText)
                                                    response.innerHTML = result2.response
                                                    document.body.style.cursor = 'auto'
                                                    document.body.appendChild(reply)
                                                }
                                            }
                                            xhr2.send()

                                        }
                                    }
                                    xhr.send()

                                } else {

                                    document.body.style.cursor = 'auto'
                                    response.innerHTML = demos[entity_type][Math.floor(Math.random()*demos[entity_type].length)]
                                    reply.value = ''
                                    document.body.appendChild(reply)

                                }

                            }

                            reset.onclick = () => {

                                if (response.innerHTML=='. . .') return

                                stage_1_firsttime = false
                                stage = 1
                                response.innerHTML = ''

                                movement_enabled = false

                                place_camera(camera_placings[camera_placings.length-1])

                                scene.remove(model_spirit)

                                try { document.body.removeChild(reset) } catch { } 
                                try { document.body.removeChild(refresh) } catch { } 
                                try { document.body.removeChild(reply) } catch { } 
                                try { document.body.removeChild(send) } catch { }

                                model_spirits_floating_inscene.forEach((m)=>{ if (m!=null) scene.remove(m) })
                                mixers_spirits_floating_inscene.forEach((m)=>{ if (m!=null) m.stopAllAction() })
                                textmeshes_inscene.forEach((m)=> scene.remove(m) )
                                textmeshes_inscene_2.forEach((m)=> scene.remove(m) )
                                model_spirits_floating_inscene = []
                                mixers_spirits_floating_inscene = []
                                textmeshes_inscene = []
                                textmeshes_inscene_2 = []

                                //console.log(renderer.info)

                            }

                            if (entity_type!='the obscure ones') {

                                loader.load('spirit '+entity_type+'.glb', function ( gltf ) {
                                    model_spirit = gltf.scene                                    
                                    mixer = new THREE.AnimationMixer(model_spirit)
                                	mixer.clipAction(gltf.animations[2]).play()
                                    scene.add(model_spirit)
                                    model_spirit.position.x = camera_placings[camera_placings.length-1][0] + .936
                                    model_spirit.position.y = camera_placings[camera_placings.length-1][1] - .666
                                    model_spirit.position.z = camera_placings[camera_placings.length-1][2] - 3.666
                                    model_spirit.rotateX(Math.PI/2)
                                    model_spirit.rotateZ(Math.PI/20)
                                })

                            }

                            else {

                                movement_enabled = true

                                document.body.appendChild(reset)
                                document.body.removeChild(refresh)
                                document.body.removeChild(send)

                                if (model_stairs == null) {
                                    loader.load('stairs.glb', function ( gltf ) {
                                        model_stairs = gltf.scene
                                        model_stairs.rotateY(Math.PI/5)
                                        model_stairs.position.y = -6
                                        model_stairs.position.z = 18
                                        model_stairs.position.x = -1.4
                                        scene.add(model_stairs)
                                    })
                                }

                                // if (model_spring == null) {
                                //     loader.load('spring.glb', function ( gltf ) {
                                //         model_spring = gltf.scene
                                //         model_spring.scale.set(0.01, 0.01, 0.01)
                                //         // model_spring.rotateY(Math.PI/5)
                                //         // model_spring.position.y = -6
                                //         // model_spring.position.z = 18
                                //         model_spring.position.x = 6//4
                                //         scene.add(model_spring)
                                //     })
                                // }

                                var floatings_loaded = true ; for (const m of model_spirits_floating) if (m==null) { floatings_loaded = false ; break}
                                if (!floatings_loaded) {
                                    for (let i = 1; i < model_spirits_floating.length+1; i++) 
                                        (new THREE.GLTFLoader()).load(('float'+i.toString()+'.glb').replace('%20',''), (gltf) => model_spirits_floating[i-1] = gltf)
                                    while (!floatings_loaded) {
                                        floatings_loaded = true ; for (const m of model_spirits_floating) if (m==null) { floatings_loaded = false ; break}
                                        await sleep(.1)
                                    }
                                }

                                const population_centers = [

                                    // [2.8984814900953606, -1.0141324546995314, -19.0324180479569, // original placement
                                    // Math.PI/2, 0, 0],

                                    // todo : add a random x,y to these
                                    
                                    [0.8984814900953606, -1.0141324546995314, -21.4624180479569], // inner 2

                                    [6.8984814900953606, -1.0141324546995314, -19.9624180479569],

                                    [4.3984814900953606, -1.0141324546995314, -11.0324180479569], // outer 2

                                    [-2.3984814900953606, -1.0141324546995314, -11.0324180479569],

                                ]

                                var seeds = null
                            
                                if (username!=null) {

                                    document.body.style.cursor = 'wait'

                                    let xhr_ = new XMLHttpRequest();
                                    xhr_.open("GET", 'https://lisica.lisica.ai:64244/aeriform2', true)
                                    xhr_.setRequestHeader("username", username)
                                    xhr_.setRequestHeader("password", password)
                                    xhr_.setRequestHeader("cmd", "init")
                                    xhr_.setRequestHeader("template", entity_type)
                                    xhr_.setRequestHeader("hm_populations_types", 4)
                                    xhr_.setRequestHeader("hm_entities_types", 5)
                                    xhr_.setRequestHeader("hm_entities_per_population", 3)
                                    xhr_.onreadystatechange = function() {
                                        if (xhr_.readyState == XMLHttpRequest.DONE) {
                                            let result = JSON.parse(xhr_.responseText)
                                            seeds = result.answer
                                            //console.log('seeds received: '+seeds)
                                        }
                                    }
                                    xhr_.send()

                                    while (seeds == null) await sleep(.1)
                                    
                                    document.body.style.cursor = 'auto'

                                    let entity_seeds = seeds[0]
                                    let population_seeds = seeds[1]
                                    let population_entities = seeds[2]
                                    console.log('entity personalities: ' + entity_seeds)
                                    console.log('population topics: ' + population_seeds)

                                    var populations = []

                                    for (let i = 0; i < population_centers.length; i++) {

                                        if (Math.random() < .999) {

                                            populations.push([])

                                            for (let ii = 0; ii < 3; ii++)

                                                if (Math.random() < .999) 
                                                
                                                    populations[populations.length-1].push(entity_seeds.indexOf(population_entities[i][ii]))

                                        } else populations.push(null)

                                    }

                                    var populations_entity_positions = []

                                    let population_ctr = -1
                                    for (const population of populations) {
                                        population_ctr +=1

                                        if (population != null) {

                                            populations_entity_positions.push([])

                                            let entity_theta = Math.PI * Math.random()

                                            let entity_ctr = -1
                                            for (const entity of population) {
                                                entity_ctr +=1

                                                let m = model_spirits_floating[entity].scene.clone()
                                                model_spirits_floating_inscene.push(m)

                                                let mix = new THREE.AnimationMixer(m)
                                                mix.clipAction(model_spirits_floating[entity].animations[2]).play()
                                                mixers_spirits_floating_inscene.push(mix)

                                                scene.add(m)

                                                let centroid = population_centers[population_ctr]
                                                let distance = 2 // todo: add a random distance to this

                                                let centroid_x = centroid[0]
                                                let centroid_z = centroid[2]

                                                entity_theta += Math.PI*2/3

                                                let x = Math.sin(entity_theta) * distance
                                                let z = Math.cos(entity_theta) * distance

                                                m.position.x = centroid_x + x
                                                m.position.z = centroid_z + z
                                                m.position.y = centroid[1]
                                                m.rotation.x = Math.PI/2
                                                m.rotation.z = Math.PI-entity_theta

                                                populations_entity_positions[populations_entity_positions.length-1].push([
                                                    m.position.x, m.position.y, m.position.z, m.rotation.x, m.rotation.z,
                                                ])

                                            }

                                            textmeshes_inscene.push(write_smt(
                                                population_seeds[population_ctr],
                                                population_centers[population_ctr][0], 
                                                population_centers[population_ctr][1]+2.75, 
                                                population_centers[population_ctr][2], 
                                                0, 0, 0
                                            ))

                                        } else populations_entity_positions.push(null)

                                    }

                                }

                                async function check_generate() {

                                    let last_picked_entity = null

                                    while (true) {

                                        let population_ctr = -1

                                        for (let centroid of population_centers) {

                                            population_ctr +=1

                                            let population = populations[population_ctr]
                                            let population_entity_positions = populations_entity_positions[population_ctr]

                                            if (Math.sqrt(Math.pow(camera.position.x-centroid[0],2)+Math.pow(camera.position.z-centroid[2],2)) < 2.4) {
                                        
                                                if (username != null) {

                                                    document.body.style.cursor = 'wait'

                                                    let entity_id = Math.floor(Math.random()*population.length)
                                                    while (entity_id == last_picked_entity) entity_id = Math.floor(Math.random()*population.length)
                                                    last_picked_entity = entity_id

                                                    console.log('in the zone ' + population_ctr + ' generating for ' + entity_id) // todo: rm me

                                                    let response = null

                                                    let xhr_ = new XMLHttpRequest()
                                                    xhr_.open("GET", 'https://lisica.lisica.ai:64244/aeriform2', true)
                                                    xhr_.setRequestHeader("username", username)
                                                    xhr_.setRequestHeader("password", password)
                                                    xhr_.setRequestHeader("cmd", "generate")
                                                    xhr_.setRequestHeader("template", entity_type)
                                                    xhr_.setRequestHeader("population_id", population_ctr)
                                                    xhr_.setRequestHeader("entity_id", entity_id)
                                                    xhr_.onreadystatechange = function() {
                                                        if (xhr_.readyState == XMLHttpRequest.DONE) {
                                                            let result = JSON.parse(xhr_.responseText)
                                                            response = result.answer
                                                            console.log('response received: '+response)
                                                        }
                                                    }
                                                    xhr_.send()
                                                    while (response == null) await sleep(.1)

                                                    document.body.style.cursor = 'auto'
                                                    
                                                    scene.remove(textmeshes_inscene_2[0])
                                                    
                                                    textmeshes_inscene_2[0] = //.push(
                                                        write_smt(
                                                            response,   // Todo: put this to real entity position
                                                            population_entity_positions[entity_id][0], 
                                                            population_entity_positions[entity_id][1]+2, 
                                                            population_entity_positions[entity_id][2], 
                                                            0,
                                                            0,
                                                            0,
                                                        )
                                                    //)

                                                    await sleep(5)

                                                }
                                                
                                                break

                                            }

                                        }

                                        await sleep(.1)

                                    }

                                } check_generate()

                            }

                            while (stage==2) await sleep(.1)

                            break

                    }

            } main()

        </script>

	</body>

</html>
